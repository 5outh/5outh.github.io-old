<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Benjamin Kovach</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="../css/site.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../js/lightbox2/dist/css/lightbox.min.css" />
    <script type="text/javascript" src="../js/lightbox2/dist/js/lightbox-plus-jquery.js"></script>
    <script type="text/javascript" src="../js/site.js?v=3"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  </head>
  <body style="margin-left: auto; margin-right: auto; display: block; max-width:800px">
    <div id="left"></div>
    <div class="wrapper">
      <header>
        <ul id="nav">
    <li><a href="../">Home</a></li>
    <li><a href="http://shop.kovach.me/">Shop</a></li>
    <li><a href="../art.html">Selected Artwork</a></li>
    <li><a href="../contact.html">About</a></li>
    <li><a href="../atom.xml">Atom</a>/<a href="../rss.xml">RSS</a></li>
</ul>


        <h3 id="blog_title">Benjamin Kovach</h3>
      </header>
      <section>
        
          <h4 class="post-title">Haskell Bits #3: Connecting to Databases</h4>
        
        <p>
<div class="post_body">
  <p>Today I want to talk about getting Haskell programs to talk to databases.</p>
<p>We’ll set out to build something pretty simple: A single table, filled with records of board games. I want to keep the focus of the post on connecting to various database types, so our board game record will be extremely simple. Here’s an example of the table we’ll be working with:</p>
<table class="checkered full-width">
<thead class="left">
<tr>
<th>
id
</th>
<th>
name
</th>
<th>
designer
</th>
<th>
year
</th>
</tr>
<thead>
<tbody>
<tr>
<td>
1
</td>
<td>
Lords of Waterdeep
</td>
<td>
Peter Lee
</td>
<td>
2012
</td>
</tr>
<tr>
<td>
3
</td>
<td>
Agricola
</td>
<td>
Uwe Rosenberg
</td>
<td>
2007
</td>
</tr>
<tr>
<td>
4
</td>
<td>
Race for the Galaxy
</td>
<td>
Thomas Lehmann
</td>
<td>
2007
</td>
</tr>
</tbody>
</table>
<p>Important note: I originally had “Chess” in here as a board game with no known year, but realized after writing the post and all of the associated code that I don’t know who designed it, either! The <code>designer</code> should technically be nullable as well, but it is not in the schema I’ve defined. Keep that in mind as you read through the post!</p>
<p>I’m going to walk through inserting a single element into a table of the aforementioned schema, but it will support all of the records above. Try inserting them as an exercise!</p>
<p>We’re going to talk about connecting to three different databases:</p>
<ul>
<li>sqlite</li>
<li>postgresql</li>
<li>mysql</li>
</ul>
<p>…with two different “flavors” of libary. First, the lower-level “-simple” strain of database libraries, and later, the higher-level <code>persistent</code> library.</p>
<h3 id="connecting-to-sqlite-with-sqlite-simple">Connecting to <code>sqlite</code> with <code>sqlite-simple</code></h3>
<p>We need a database:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql">$ sqlite3 board_games.db <span class="ot">&quot;CREATE TABLE IF NOT EXISTS board_games (id INTEGER PRIMARY KEY,</span>
name TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>, designer TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>, <span class="dt">year</span> <span class="dt">INTEGER</span>);<span class="ot">&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE RecordWildCards #-}</span>
<span class="ot">{-# LANGUAGE OverloadedStrings #-}</span>

<span class="kw">import </span><span class="dt">Control.Monad.State</span>
<span class="kw">import </span><span class="dt">Control.Monad.Reader</span>
<span class="kw">import </span><span class="dt">Data.Text</span>
<span class="kw">import </span><span class="dt">Database.SQLite.Simple</span>
<span class="kw">import </span><span class="dt">Data.Maybe</span> (fromJust)

<span class="kw">data</span> <span class="dt">BoardGame</span> <span class="fu">=</span> <span class="dt">BoardGame</span>
    {<span class="ot"> name ::</span> <span class="dt">Text</span>
    ,<span class="ot"> designer ::</span> <span class="dt">Text</span>
    ,<span class="ot"> year ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>
    } <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>)

<span class="kw">instance</span> <span class="dt">FromRow</span> <span class="dt">BoardGame</span> <span class="kw">where</span>
    fromRow <span class="fu">=</span> <span class="dt">BoardGame</span> <span class="fu">&lt;$&gt;</span> field <span class="fu">&lt;*&gt;</span> field <span class="fu">&lt;*&gt;</span> field

<span class="kw">instance</span> <span class="dt">ToRow</span> <span class="dt">BoardGame</span> <span class="kw">where</span>
    toRow <span class="dt">BoardGame</span>{<span class="fu">..</span>} <span class="fu">=</span> toRow (name, designer, year)

<span class="ot">createGame ::</span> <span class="dt">BoardGame</span> <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> <span class="dt">Connection</span> <span class="dt">IO</span> (<span class="dt">Int</span>, <span class="dt">BoardGame</span>)
createGame game <span class="fu">=</span> ask <span class="fu">&gt;&gt;=</span> \conn <span class="ot">-&gt;</span> <span class="kw">do</span>
    liftIO <span class="fu">$</span> execute
        conn 
        <span class="st">&quot;INSERT INTO board_games (name, designer, year) VALUES (?,?,?)&quot;</span>
        game
    boardGameId <span class="ot">&lt;-</span> fromIntegral <span class="fu">&lt;$&gt;</span> liftIO (lastInsertRowId conn)
    game' <span class="ot">&lt;-</span> fromJust <span class="fu">&lt;$&gt;</span> readGame boardGameId
    pure (boardGameId, game')

<span class="ot">readGame ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> <span class="dt">Connection</span> <span class="dt">IO</span> (<span class="dt">Maybe</span> <span class="dt">BoardGame</span>)
readGame boardGameId <span class="fu">=</span> ask <span class="fu">&gt;&gt;=</span> \conn <span class="ot">-&gt;</span> <span class="kw">do</span>
    games <span class="ot">&lt;-</span> liftIO <span class="fu">$</span> query 
        conn
        <span class="st">&quot;SELECT name, designer, year FROM board_games WHERE id = ?&quot;</span>
        (<span class="dt">Only</span> boardGameId)
    pure <span class="fu">$</span> <span class="kw">case</span> games <span class="kw">of</span>
         [g] <span class="ot">-&gt;</span> <span class="dt">Just</span> g
         _ <span class="ot">-&gt;</span> <span class="dt">Nothing</span>

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
    conn <span class="ot">&lt;-</span> open <span class="st">&quot;board_games.db&quot;</span>
    flip runReaderT conn <span class="fu">$</span> <span class="kw">do</span>
        result <span class="ot">&lt;-</span> createGame <span class="fu">$</span> <span class="dt">BoardGame</span>
            <span class="st">&quot;Cosmic Encounter&quot;</span>
            <span class="st">&quot;Bill Eberle&quot;</span>
            (<span class="dt">Just</span> <span class="dv">2008</span>)
        liftIO <span class="fu">$</span> print result</code></pre></div>
<p>(packages needed: <code>sqlite-simple</code>, <code>mtl</code>, <code>text</code>)</p>
<p>This is the core logic we’ll be implementing with each library. We’ll just be modifying this piecemeal for the rest of the implementations. It’s the longest code sample in the post, so don’t run off!</p>
<p>Let’s walk through this a little, just once. Here’s what we’re doing:</p>
<ul>
<li>Creating a connection (called <code>conn</code>)</li>
<li>Storing it in a read-only environment with <code>ReaderT</code> computations</li>
<li>Creating a new record for Cosmic Encounter</li>
<li>Then printing it, along with its id in the database.</li>
</ul>
<p>In order to do this, we have to write a little bit of boilerplate. First is the model definition for <code>BoardGame</code>, and instances of <code>ToRow</code> and <code>FromRow</code>, which allow us to serialize and deserialize from the <code>sqlite</code> representation of a <code>BoardGame</code>. We also have to write the actual SQL commands; not a whole lot is abstracted away from us.</p>
<p>(I lied a little - the model definition is not strictly necessary but it’s typically good to pull data into your program’s domain, so I suggest doing this step.)</p>
<h3 id="connecting-to-postgresql-with-postgresql-simple">Connecting to <code>postgresql</code> with <code>postgresql-simple</code></h3>
<p>We’ll need a database, again (note the syntax is slightly different):</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> board_games (
  <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,
  name TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,
  designer TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,
  <span class="dt">year</span> <span class="dt">INTEGER</span>
);</code></pre></div>
<p>Otherwise, we don’t have a ton to change. We only have to touch a few things:</p>
<ul>
<li>The way that we procure a <code>Connection</code> is slightly different, because we’re no longer using a flat file</li>
<li><code>lastInsertRowId</code> is not a primitive. Postgres supports <code>RETURNING</code> syntax so we can get the <code>id</code> when we insert.</li>
<li>The imports have to change.</li>
</ul>
<p>That’s actually…it. Here are the imports we need:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Database.PostgreSQL.Simple</span>
<span class="kw">import </span><span class="dt">Database.PostgreSQL.Simple.FromRow</span>
<span class="kw">import </span><span class="dt">Database.PostgreSQL.Simple.ToRow</span></code></pre></div>
<p>Here is the new <code>createGame</code>:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">createGame ::</span> <span class="dt">BoardGame</span> <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> <span class="dt">Connection</span> <span class="dt">IO</span> (<span class="dt">Int</span>, <span class="dt">BoardGame</span>)
createGame game <span class="fu">=</span> ask <span class="fu">&gt;&gt;=</span> \conn <span class="ot">-&gt;</span> <span class="kw">do</span>
    [<span class="dt">Only</span> boardGameId] <span class="ot">&lt;-</span> liftIO <span class="fu">$</span> query
        conn 
        <span class="st">&quot;INSERT INTO board_games (name, designer, year) VALUES (?,?,?) RETURNING id&quot;</span>
        game
    game' <span class="ot">&lt;-</span> fromJust <span class="fu">&lt;$&gt;</span> readGame boardGameId
    pure (boardGameId, game')</code></pre></div>
<p>And here is the new connection procuring mechanism (this uses a <a href="https://www.postgresql.org/docs/9.4/static/libpq-connect.html#LIBPQ-CONNSTRING">postgres connection string</a>, so suit it to your needs):</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- Inside `main`:</span>
conn <span class="ot">&lt;-</span> connectPostgreSQL <span class="st">&quot;host=localhost port=5432 connect_timeout=10&quot;</span></code></pre></div>
<p>(packages needed: <code>postgresql-simple</code>, <code>mtl</code>, <code>text</code>)</p>
<p><a href="https://gist.github.com/5outh/31acec58bbd91413d71a0df2638fe899">Check out the full source here</a>.</p>
<h3 id="connecting-to-mysql-with-mysql-simple">Connecting to <code>mysql</code> with <code>mysql-simple</code></h3>
<p>The last database we’ll get this running on is <code>mysql</code>. <code>mysql-simple</code> was the original “-simple” library for database management. However, it’s also the most different.</p>
<p>First, creating the table:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> `board_games` (
  `id` <span class="dt">int</span>(<span class="dv">11</span>) unsigned <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT,
  `name` <span class="dt">varchar</span>(<span class="dv">64</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="st">''</span>,
  `designer` <span class="dt">varchar</span>(<span class="dv">64</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="st">''</span>,
  `year` <span class="dt">int</span>(<span class="dv">4</span>) <span class="kw">DEFAULT</span> <span class="kw">NULL</span>,
  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (`id`)
) ENGINE=InnoDB <span class="kw">DEFAULT</span> CHARSET=utf8;</code></pre></div>
<p>We’ll need the language extension <code>BangPatterns</code> (not necessary, but recommended):</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE BangPatterns #-}</span></code></pre></div>
<p>and some updated imports:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Database.MySQL.Simple</span>
<span class="kw">import </span><span class="dt">Database.MySQL.Simple.QueryParams</span>
<span class="kw">import </span><span class="dt">Database.MySQL.Simple.QueryResults</span>
<span class="kw">import </span><span class="dt">Database.MySQL.Simple.Param</span>
<span class="kw">import </span><span class="dt">Database.MySQL.Simple.Result</span></code></pre></div>
<p>Our <code>BoardGame</code> type can stay the same, but <code>ToRow</code> and <code>FromRow</code> get replaced with the typeclasses <code>QueryParams</code> and <code>QueryResults</code> respectively. Their interfaces are a little different too:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">QueryParams</span> <span class="dt">BoardGame</span> <span class="kw">where</span>
    renderParams <span class="dt">BoardGame</span>{<span class="fu">..</span>} <span class="fu">=</span> [render name, render designer, render year]

<span class="kw">instance</span> <span class="dt">QueryResults</span> <span class="dt">BoardGame</span> <span class="kw">where</span>
    convertResults [fa,fb,fc] [va,vb,vc] <span class="fu">=</span> <span class="dt">BoardGame</span> a b c 
        <span class="kw">where</span> <span class="fu">!</span>a <span class="fu">=</span> convert fa va
              <span class="fu">!</span>b <span class="fu">=</span> convert fb vb
              <span class="fu">!</span>c <span class="fu">=</span> convert fc vc
    convertResults fs vs  <span class="fu">=</span> convertError fs vs <span class="dv">3</span></code></pre></div>
<p>We need to go back to selecting the last insert id, but there’s no primitive for that, so we inline it and make some small modifications to <code>createGame</code>:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">createGame ::</span> <span class="dt">BoardGame</span> <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> <span class="dt">Connection</span> <span class="dt">IO</span> (<span class="dt">Int</span>, <span class="dt">BoardGame</span>)
createGame game <span class="fu">=</span> ask <span class="fu">&gt;&gt;=</span> \conn <span class="ot">-&gt;</span> <span class="kw">do</span>
    liftIO <span class="fu">$</span> execute
        conn 
        <span class="st">&quot;INSERT INTO board_games (name, designer, year) VALUES (?,?,?)&quot;</span>
        game
    [<span class="dt">Only</span> boardGameId] <span class="ot">&lt;-</span> liftIO <span class="fu">$</span> query_ conn <span class="st">&quot;SELECT LAST_INSERT_ID()&quot;</span>
    game' <span class="ot">&lt;-</span> fromJust <span class="fu">&lt;$&gt;</span> readGame boardGameId 
    pure (boardGameId, game')</code></pre></div>
<p>Connection info is provided using <code>ConnectInfo</code> instead of a postgres connection string:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">connectInfo ::</span> <span class="dt">ConnectInfo</span>
connectInfo <span class="fu">=</span> defaultConnectInfo
    { connectDatabase <span class="fu">=</span> <span class="st">&quot;board_games&quot;</span>
    }</code></pre></div>
<p>The last step is to swap the connection line in <code>main</code> to:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- Inside main</span>
conn <span class="ot">&lt;-</span> connect connectInfo </code></pre></div>
<p>(packages needed: <code>postgresql-simple</code>, <code>mtl</code>, <code>text</code>)</p>
<p><a href="https://gist.github.com/5outh/5b53643979fb510ded470f8c0bb449e3">Check out the full source here</a></p>
<p>These libraries are not all that different - they’re all inspired by one-another. You may find documentation or tutorials that use one of these libraries and need to use another; I hope this helps translate between the languages of the three.</p>
<p>Next, I’d like to talk about <code>persistent</code>. <code>persistent</code> is a higher-level, more fully featured set of database tooling. It’s a lot more “magical” than the “-simple” libraries, but removes the necessity of some of the boilerplate and inlining of raw SQL that comes with the “-simple” variants. It’s also backend-agnostic which makes for a uniform interface.</p>
<h3 id="connecting-to-sqlite-with-persistent">Connecting to <code>sqlite</code> with <code>persistent</code></h3>
<p>We’ll need a data type definition in <code>persistent</code>’s template haskell DSL, which we’ll put in a module called <code>Types</code>:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE TemplateHaskell #-}</span>
<span class="ot">{-# LANGUAGE QuasiQuotes #-}</span>
<span class="ot">{-# LANGUAGE TypeFamilies #-}</span>
<span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span>
<span class="ot">{-# LANGUAGE GADTs #-}</span>
<span class="ot">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>

<span class="kw">module</span> <span class="dt">Types</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Database.Persist.TH</span>

share [mkPersist sqlSettings, mkMigrate <span class="st">&quot;migrateAll&quot;</span>] [persistLowerCase<span class="fu">|</span>
<span class="dt">BoardGame</span> sql<span class="fu">=</span>board_games
    name <span class="dt">String</span>
    designer <span class="dt">String</span>
    year <span class="dt">Int</span> <span class="dt">Maybe</span>

    <span class="dt">UniqueName</span> name

    <span class="kw">deriving</span> <span class="dt">Show</span>
<span class="fu">|</span>]</code></pre></div>
<p>The translated source:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span>

<span class="kw">import </span><span class="dt">Types</span>

<span class="kw">import </span><span class="dt">Database.Persist.Sqlite</span>
<span class="kw">import </span><span class="dt">Control.Monad.Logger</span>
<span class="kw">import </span><span class="dt">Control.Monad.IO.Class</span>

<span class="ot">printIO ::</span> (<span class="dt">MonadIO</span> m, <span class="dt">Show</span> a) <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> m ()
printIO <span class="fu">=</span> liftIO <span class="fu">.</span> print

<span class="ot">createGame ::</span> <span class="dt">MonadIO</span> m <span class="ot">=&gt;</span> <span class="dt">BoardGame</span> <span class="ot">-&gt;</span> <span class="dt">SqlPersistT</span> m (<span class="dt">Entity</span> <span class="dt">BoardGame</span>) 
createGame <span class="fu">=</span> insertEntity

<span class="ot">readGame ::</span> <span class="dt">MonadIO</span> m <span class="ot">=&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">SqlPersistT</span> m (<span class="dt">Maybe</span> <span class="dt">BoardGame</span>) 
readGame <span class="fu">=</span> get <span class="fu">.</span> toSqlKey <span class="fu">.</span> fromIntegral

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> 
    runStdoutLoggingT
        <span class="fu">.</span> withSqlitePool <span class="st">&quot;board_games.db&quot;</span> <span class="dv">3</span>
        <span class="fu">.</span> runSqlPool
        <span class="fu">$</span> <span class="kw">do</span>
            result <span class="ot">&lt;-</span> createGame <span class="fu">$</span> <span class="dt">BoardGame</span>
                <span class="st">&quot;Cosmic Encounter&quot;</span>
                <span class="st">&quot;Bill Eberle&quot;</span>
                (<span class="dt">Just</span> <span class="dv">2008</span>)
            liftIO <span class="fu">$</span> print result

            <span class="co">-- This is the easiest way to re-read a record:</span>
            get (entityKey result) <span class="fu">&gt;&gt;=</span> printIO 

            <span class="co">-- Getting by id</span>
            readGame <span class="dv">1</span> <span class="fu">&gt;&gt;=</span> printIO 
            
            <span class="co">-- Get by name too:</span>
            getBy (<span class="dt">UniqueName</span> <span class="st">&quot;Cosmic Encounter&quot;</span>) <span class="fu">&gt;&gt;=</span> printIO </code></pre></div>
<p>(packages needed: <code>persistent</code>, <code>persistent-template</code>, <code>persistent-sqlite</code>, <code>mtl</code>, <code>monad-logger</code>)</p>
<p>A couple of things:</p>
<ul>
<li><code>SqlPersistT</code> can be thought of as a “SQL Statement Context” - you can write arbitrary queries in these blocks. <em>Each of these is run in its own transaction by default, so be careful! Any exceptions will roll back any changes.</em> (thanks to /u/ephrion for bringing up this point!)</li>
<li><code>BoardGame</code> and <code>UniqueName</code> are types generated by the template haskell in the <code>Types</code> module.</li>
<li>This uses a connection pool with 3 open connections. You can also create a single connection with <code>withSqliteConn</code> instead of <code>withSqlitePool</code>.</li>
<li><code>Entity</code> is a type consisting of a <code>Key</code> and a model (in our case, <code>BoardGame</code>) - this is analogous to <code>(Int, BoardGame)</code> with the <code>-simple</code> libraries.</li>
<li><code>runStdoutLoggingT</code> prints debug SQL statements to stdout. It can be replaced with <code>runNoLoggingT</code> or <code>runStderrLoggingT</code> to modify this behavior.</li>
</ul>
<p>This is just the tip of the iceberg. See <a href="http://www.yesodweb.com/book/persistent">the Yesod book’s chapter on persistent</a>, the <a href="https://www.stackage.org/lts-8.0/package/persistent-2.6">persistent documentation</a> and specifically the <a href="https://www.stackage.org/haddock/lts-8.0/persistent-2.6/Database-Persist-Class.html">Database.Persist.Class module</a> for more information.</p>
<p>Also see the <a href="https://www.stackage.org/package/persistent-sqlite">persistent-sqlite documentation</a>.</p>
<h3 id="connecting-to-postgres-with-persistent">Connecting to <code>postgres</code> with <code>persistent</code></h3>
<p>Change the <code>Database.Persist.Sqlite</code> import to <code>Database.Persist.Postgres</code>.</p>
<p>The only other thing to change in order to connect to <code>postgres</code> instead is the second line of <code>main</code>, to:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">.</span> withPostgresqlPool <span class="st">&quot;host=localhost port=5432 connect_timeout=10&quot;</span> <span class="dv">3</span></code></pre></div>
<p>(packages needed: <code>persistent</code>, <code>persistent-template</code>, <code>persistent-postgresql</code>, <code>mtl</code>, <code>monad-logger</code>)</p>
<p>Everything else works the same!</p>
<p><a href="https://gist.github.com/5outh/d2f6a8762701928ceb967d25710c7ed1">View the full source here</a></p>
<p>And the <a href="https://www.stackage.org/lts-8.0/package/persistent-postgresql-2.6">persistent-postgresql documentation</a></p>
<h3 id="connecting-to-mysql-with-persistent">Connecting to <code>mysql</code> with <code>persistent</code></h3>
<p>Connecting to mysql is almost as simple. Change the import to <code>Database.Persist.MySQL</code>, add the <code>ConnectInfo</code> definition:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">connectInfo ::</span> <span class="dt">ConnectInfo</span>
connectInfo <span class="fu">=</span> defaultConnectInfo
    { connectDatabase <span class="fu">=</span> <span class="st">&quot;board_games&quot;</span>
    }</code></pre></div>
<p>and change the same line in <code>main</code> to:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">.</span> withMySQLPool connectInfo <span class="dv">3</span></code></pre></div>
<p>(packages needed: <code>persistent</code>, <code>persistent-template</code>, <code>persistent-mysql</code>, <code>mtl</code>, <code>monad-logger</code>)</p>
<p>Again, everything else works the same.</p>
<p><a href="https://gist.github.com/5outh/b9d80d7fc174ae5aa87818dfd5158362">View the full source here</a></p>
<p>And the <a href="https://www.stackage.org/lts-8.0/package/persistent-mysql-2.6">persistent-mysql documentation</a></p>
<p>I’ve never attempted to run a database-backed haskell application on Windows, so I must apologize for not showing off how to connect to SQL Server. AFAIK, the only current package that supports this is <a href="https://github.com/hdbc/hdbc">HDBC</a>, which I’ve not used.</p>
<p>What is your preferred way of interacting with databases in Haskell? Which database do you think is the most pleasant to work with? What parts of this post would you like to see expanded on in the future? Let me know in the comments!</p>
<p>Ben</p>
</div>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'abstract-nonsense'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</p>
      </section>
      <footer class="footer">
        © 2018 Benjamin Kovach
        <br />
        Site proudly generated by <a href="https://jaspervdj.be/hakyll/">Hakyll</a>
      </footer>
    </div>
    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-53651640-1', 'auto');
      ga('send', 'pageview');

    </script>
    <script>
      lightbox.option({
        resizeDuration: 200,
      })
    </script>
  </body>
</html>
